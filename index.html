<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Focis Mini Játék – Full</title>
<style>
  :root { --green:#4caf50; --accent:#007bff; }
  * { box-sizing: border-box; }
  body { margin:0; background:#6ab04c; font-family:Segoe UI, Tahoma, Geneva, Verdana, sans-serif; color:#fff; text-align:center; }
  h1 { margin:10px 8px; text-shadow:2px 2px 5px #27411e; }
  #wrap { max-width:900px; margin:0 auto; padding:0 8px 16px; }
  canvas { width:100%; height:auto; background:var(--green); display:block; border:4px solid #fff; box-shadow:0 0 10px #3a7d2e; margin:0 auto; }
  #controls { display:flex; gap:8px; flex-wrap:wrap; justify-content:center; align-items:center; margin:12px 0; }
  button, select { border:none; border-radius:10px; padding:10px 14px; font-size:16px; cursor:pointer; }
  #shootBtn { background:var(--accent); color:#fff; font-weight:600; box-shadow:0 4px 10px rgba(0,0,0,.2); }
  #resetBtn { background:#fff; color:#333; }
  #modeSel { background:#fff; color:#333; }
  #stats { font-size:15px; opacity:.95; }
  #signature { position:fixed; right:10px; bottom:10px; font-size:14px; color:rgba(255,255,255,.85); font-style:italic; pointer-events:none; text-shadow:0 0 3px rgba(0,0,0,.5); animation:pulse 3s ease-in-out infinite; }
  @keyframes pulse { 0%{opacity:.1} 50%{opacity:.75} 100%{opacity:.1} }
  @media (max-width:520px){ h1{font-size:18px} button,select{font-size:15px} }
</style>
</head>
<body>
  <div id="wrap">
    <h1>⚽ Büntetőrúgás – Full (© Adrián)</h1>
    <canvas id="game" width="900" height="500"></canvas>

    <div id="controls">
      <button id="shootBtn">Lőj!</button>
      <button id="resetBtn">Újrakezd</button>
      <select id="modeSel" title="Mód">
        <option value="normal">Normál mód</option>
        <option value="timed">60s kihívás</option>
      </select>
      <span id="stats">Szint: <b id="lv">1</b> • Pont: <b id="sc">0</b> • Rekord: <b id="hi">0</b> <span id="tLeft"></span></span>
    </div>
  </div>

  <div id="signature">© Adrián</div>

<script>
/* ===== Alapok ===== */
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;

const kapu = { left:300, right:600-100, top:50, bottom:150 }; // posztok: 300..500
kapu.right = 500;

const lvEl = document.getElementById('lv');
const scEl = document.getElementById('sc');
const hiEl = document.getElementById('hi');
const tLeftEl = document.getElementById('tLeft');

const shootBtn = document.getElementById('shootBtn');
const resetBtn = document.getElementById('resetBtn');
const modeSel  = document.getElementById('modeSel');

let score = 0, level = 1, maxLevel = 5;
let HS_KEY = 'foci_full_hi_v1';
let hiscore = parseInt(localStorage.getItem(HS_KEY)||'0')||0; hiEl.textContent = hiscore;

let mode = 'normal'; // 'normal' | 'timed'
let timeLeft = 0, timerOn = false;

/* ===== Hangok (WebAudio) ===== */
const AC = (window.AudioContext||window.webkitAudioContext) ? new (window.AudioContext||window.webkitAudioContext)() : null;
function beep(freq=660, dur=0.08, type='square', vol=0.08){
  if(!AC) return;
  const o = AC.createOscillator();
  const g = AC.createGain();
  o.type = type; o.frequency.value = freq;
  g.gain.value = vol;
  o.connect(g); g.connect(AC.destination);
  o.start(); o.stop(AC.currentTime + dur);
}
const sKick = ()=>beep(660, .06, 'square', .09);
const sGoal = ()=>{ beep(880,.10,'sine',.10); setTimeout(()=>beep(1320,.08,'sine',.08),90); };
const sSave = ()=>beep(220,.10,'triangle',.10);
const sLevel= ()=>beep(1200,.12,'sine',.09);

/* ===== Kapus ===== */
const keeper = {
  x: 375, y: 90, w: 60, h: 60, vx: 4,
  cooldown: 0
};
function keeperAI(){
  // alap oda-vissza
  keeper.x += keeper.vx;
  if (keeper.x <= kapu.left || keeper.x + keeper.w >= kapu.right) keeper.vx *= -1;

  // kis „emberi hiba”: random irányváltás, néha lassítás/gyorsítás
  if (Math.random() < 0.01) keeper.vx *= -1;
  if (Math.random() < 0.01) keeper.vx *= (Math.random()<.5?0.7:1.3);

  // korlátozás sebességre szintenént
  const base = 4 + (level-1)*1.3;
  keeper.vx = Math.max(Math.min(keeper.vx, base), -base);
}

/* ===== Labda és irányítás ===== */
const ball = { x: W/2, y: H-50, r: 15, moving:false, vx:0, vy:0 };
let aim = { x: ball.x, y: ball.y-350 };
let showGuide = true;

function circleRectCollide(cx,cy,cr, rx,ry,rw,rh){
  // legközelebbi pont a téglalapon
  const nx = Math.max(rx, Math.min(cx, rx+rw));
  const ny = Math.max(ry, Math.min(cy, ry+rh));
  const dx = cx - nx, dy = cy - ny;
  return (dx*dx + dy*dy) <= cr*cr;
}

/* ===== Pálya rajz ===== */
function drawField(){
  // fű
  ctx.fillStyle = '#4caf50';
  ctx.fillRect(0,0,W,H);

  // kapu keret
  ctx.strokeStyle = '#fff'; ctx.lineWidth = 4;
  ctx.beginPath();
  ctx.rect(kapu.left, kapu.top, kapu.right-kapu.left, kapu.bottom-kapu.top);
  ctx.stroke();

  // kapuháló
  ctx.strokeStyle = '#ddd'; ctx.lineWidth = 1;
  for(let x=kapu.left; x<=kapu.right; x+=20){ ctx.beginPath(); ctx.moveTo(x, kapu.top); ctx.lineTo(x, kapu.bottom); ctx.stroke(); }
  for(let y=kapu.top; y<=kapu.bottom; y+=20){ ctx.beginPath(); ctx.moveTo(kapu.left, y); ctx.lineTo(kapu.right, y); ctx.stroke(); }

  // 16-os félkör
  ctx.strokeStyle = '#fff'; ctx.lineWidth = 4;
  ctx.beginPath(); ctx.arc((kapu.left+kapu.right)/2, kapu.bottom, 100, Math.PI, 2*Math.PI); ctx.stroke();
}

function drawKeeper(){
  // árnyék
  ctx.fillStyle = 'rgba(0,0,0,.15)';
  ctx.fillRect(keeper.x+6, keeper.y+keeper.h+6, keeper.w, 10);

  // fej
  ctx.fillStyle = '#f5c9a3';
  ctx.beginPath(); ctx.arc(keeper.x+keeper.w/2, keeper.y+15, 15, 0, Math.PI*2); ctx.fill(); ctx.strokeStyle='#222'; ctx.stroke();

  // test
  ctx.fillStyle = '#1e88e5'; ctx.fillRect(keeper.x+10, keeper.y+30, keeper.w-20, 50);
  // karok
  ctx.fillStyle = '#1565c0'; ctx.fillRect(keeper.x, keeper.y+30, 10, 40); ctx.fillRect(keeper.x+keeper.w-10, keeper.y+30, 10, 40);
  // lábak
  ctx.fillStyle = '#222'; ctx.fillRect(keeper.x+10, keeper.y+80, 12, 30); ctx.fillRect(keeper.x+keeper.w-22, keeper.y+80, 12, 30);
}

function drawBall(){
  const g = ctx.createRadialGradient(ball.x-5,ball.y-5,5, ball.x,ball.y,ball.r);
  g.addColorStop(0,'#fff'); g.addColorStop(1,'#999');
  ctx.fillStyle = g;
  ctx.beginPath(); ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2); ctx.fill();
  ctx.strokeStyle='#444'; ctx.stroke();

  // kis minta
  ctx.fillStyle = '#000'; ctx.beginPath();
  ctx.moveTo(ball.x-7,ball.y-5); ctx.lineTo(ball.x-2,ball.y+2); ctx.lineTo(ball.x+2,ball.y-2); ctx.closePath(); ctx.fill();
}

function drawGuide(){
  if (ball.moving || !showGuide) return;
  ctx.strokeStyle = 'rgba(255,255,255,.9)'; ctx.lineWidth = 2;
  ctx.beginPath(); ctx.moveTo(ball.x, ball.y); ctx.lineTo(aim.x, aim.y); ctx.stroke();
  ctx.fillStyle = 'rgba(255,255,255,.9)'; ctx.beginPath(); ctx.arc(aim.x, aim.y, 5, 0, Math.PI*2); ctx.fill();
}

function drawHUD(){
  ctx.fillStyle = '#fff'; ctx.font = '20px Arial';
  ctx.fillText('Pont: '+score, 20, 34);
  ctx.fillText('Szint: '+level, 20, 60);
}

/* ===== Játékmenet ===== */
function resetRound(startTimer=false){
  score = 0; level = 1; keeper.vx = 4; ball.moving=false;
  ball.x = W/2; ball.y = H-50; aim.x = ball.x; aim.y = ball.y-350;
  updateStats();
  if (startTimer){ mode='timed'; modeSel.value='timed'; timeLeft = 60; timerOn = true; tickTimer(); }
  else { mode='normal'; modeSel.value='normal'; timerOn=false; tLeftEl.textContent=''; }
}

function tickTimer(){
  if (!timerOn) return;
  tLeftEl.textContent = `• Idő: ${timeLeft}s`;
  if (timeLeft<=0){
    timerOn=false;
    alert(`⏱️ Idő lejárt! Pont: ${score}`);
    saveHi();
    return;
  }
  setTimeout(()=>{ timeLeft--; tickTimer(); },1000);
}

function saveHi(){ if (score>hiscore){ hiscore=score; localStorage.setItem(HS_KEY, hiscore); } }

function checkLevelUp(){
  if (score>0 && score % 5 === 0 && level<maxLevel){
    level++;
    sLevel();
    // kis buff a kapusnak
    keeper.vx = (Math.random()<.5?-1:1) * (4 + (level-1)*1.3);
    alert(`Gratulálok! Szint ${level}.`);
  }
}

function updateStats(){
  lvEl.textContent = level;
  scEl.textContent = score;
  hiEl.textContent = hiscore;
}

/* Labda mozgás és ütközések */
function stepBall(){
  if (!ball.moving) return;

  ball.x += ball.vx;
  ball.y += ball.vy;

  // ütközés kapussal
  if (circleRectCollide(ball.x,ball.y,ball.r, keeper.x, keeper.y, keeper.w, keeper.h)){
    ball.moving = false; sSave();
    // vissza alapra
    ball.x = W/2; ball.y = H-50; aim.x = ball.x; aim.y = ball.y-350;
    return;
  }

  // GÓL: áthalad a kapuvonalon (kapu.top) a két kapufa között
  if (ball.y - ball.r <= kapu.top && ball.x >= kapu.left && ball.x <= kapu.right){
    ball.moving = false; score++; sGoal(); saveHi(); checkLevelUp(); updateStats();
    // reset labda
    ball.x = W/2; ball.y = H-50; aim.x = ball.x; aim.y = ball.y-350;
    return;
  }

  // mellé/fölé: elhagyta a pályát
  if (ball.y + ball.r < 0 || ball.y - ball.r > H || ball.x + ball.r < 0 || ball.x - ball.r > W){
    ball.moving = false; sSave(); // „nem sikerült” jelzésnek rövid hang
    ball.x = W/2; ball.y = H-50; aim.x = ball.x; aim.y = ball.y-350;
  }
}

/* ===== Bemenet (egér/érintés) ===== */
function getPos(e){
  const r = canvas.getBoundingClientRect();
  const cx = (e.touches?e.touches[0].clientX:e.clientX) - r.left;
  const cy = (e.touches?e.touches[0].clientY:e.clientY) - r.top;
  return { x: cx*(canvas.width/r.width), y: cy*(canvas.height/r.height) };
}

// Labda hely kiválasztása: csak a pálya alsó sávjában
function pickBall(p){
  if (ball.moving) return;
  if (p.y > H-120){
    ball.x = p.x; ball.y = p.y; aim.x = p.x; aim.y = p.y - 350;
    beep(520,.05,'sine',.06);
  }
}

canvas.addEventListener('click', e=>{ pickBall(getPos(e)); });
canvas.addEventListener('mousemove', e=>{ if(!ball.moving){ const p=getPos(e); aim.x=p.x; aim.y=p.y; } });

canvas.addEventListener('touchstart', e=>{ e.preventDefault(); pickBall(getPos(e)); }, {passive:false});
canvas.addEventListener('touchmove',  e=>{ e.preventDefault(); if(!ball.moving){ const p=getPos(e); aim.x=p.x; aim.y=p.y; } }, {passive:false});

window.addEventListener('keydown', e=>{ if(e.code==='Space' && !ball.moving) shoot(); });

shootBtn.addEventListener('click', ()=>{ if(!ball.moving) shoot(); });
resetBtn.addEventListener('click', ()=> resetRound(modeSel.value==='timed') );
modeSel.addEventListener('change', e=>{
  if (e.target.value==='timed') resetRound(true);
  else resetRound(false);
});

function shoot(){
  // irányvektor
  const dx = aim.x - ball.x, dy = aim.y - ball.y;
  const d = Math.hypot(dx,dy)||1;
  const sp = 12; // labdasebesség
  ball.vx = (dx/d)*sp; ball.vy = (dy/d)*sp;
  ball.moving = true; sKick();
}

/* ===== Fő ciklus ===== */
function update(){
  keeperAI();
  stepBall();
}
function render(){
  ctx.clearRect(0,0,W,H);
  drawField();
  drawKeeper();
  drawBall();
  drawGuide();
  drawHUD();
}

function loop(){
  update();
  render();
  requestAnimationFrame(loop);
}

/* ===== Indítás ===== */
function init(){
  resetRound(false);
  updateStats();
  loop();
}
init();
</script>
</body>
</html>
